<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1143px" height="813px" viewBox="-0.5 -0.5 1143 813"><defs/><g><path d="M 586 183.5 L 586 214.8 L 585.7 214.8 L 585.69 239.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 585.69 244.88 L 582.19 237.88 L 585.69 239.63 L 589.19 237.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="531" y="168.5" width="110" height="15" rx="2.25" ry="2.25" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 176px; margin-left: 532px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">logger(单例)</div></div></div></foreignObject></g><path d="M 786 176 L 647.37 176" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 642.12 176 L 649.12 172.5 L 647.37 176 L 649.12 179.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="786" y="161" width="80" height="30" rx="4.5" ry="4.5" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 176px; margin-left: 787px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">config</div></div></div></foreignObject></g><path d="M 926 166 L 896 166 L 896 176 L 872.37 176" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 867.12 176 L 874.12 172.5 L 872.37 176 L 874.12 179.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="926" y="156" width="70" height="20" rx="3" ry="3" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 68px; height: 1px; padding-top: 166px; margin-left: 927px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">log_level</div></div></div></foreignObject></g><path d="M 926 186 L 896 186 L 896 176 L 872.37 176" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 867.12 176 L 874.12 172.5 L 872.37 176 L 874.12 179.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="926" y="176" width="70" height="20" rx="3" ry="3" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 68px; height: 1px; padding-top: 186px; margin-left: 927px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">writer_type</div></div></div></foreignObject></g><rect x="700" y="146" width="40" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 156px; margin-left: 720px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">0.配置并初始化单例对象</div></div></div></foreignObject></g><path d="M 536 66 L 586 66 L 586 99.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 586 104.88 L 582.5 97.88 L 586 99.63 L 589.5 97.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="486" y="56" width="50" height="20" rx="3" ry="3" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 48px; height: 1px; padding-top: 66px; margin-left: 487px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">info</div></div></div></foreignObject></g><rect x="536" y="56" width="50" height="20" rx="3" ry="3" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 48px; height: 1px; padding-top: 66px; margin-left: 537px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">warn</div></div></div></foreignObject></g><rect x="586" y="56" width="50" height="20" rx="3" ry="3" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 48px; height: 1px; padding-top: 66px; margin-left: 587px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">error</div></div></div></foreignObject></g><rect x="636" y="56" width="50" height="20" rx="3" ry="3" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 48px; height: 1px; padding-top: 66px; margin-left: 637px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">debug</div></div></div></foreignObject></g><path d="M 586 126 L 586 162.13" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 586 167.38 L 582.5 160.38 L 586 162.13 L 589.5 160.38 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="553.5" y="106" width="65" height="20" rx="3" ry="3" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 63px; height: 1px; padding-top: 116px; margin-left: 555px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">write_log</div></div></div></foreignObject></g><rect x="766" y="106" width="40" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 116px; margin-left: 786px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">1. 调用封装的不同日志级别的接口,以格式化的方式写入日志</div></div></div></foreignObject></g><rect x="796" y="216" width="40" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 226px; margin-left: 816px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">2.遍历 appender的map 将格式化并拼接好日志格式的append给各个appender对象</div></div></div></foreignObject></g><path d="M 585.7 266 L 585.7 296 L 586 296 L 586 319.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 586 324.88 L 582.5 317.88 L 586 319.63 L 589.5 317.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 526 256 L 456 256 L 456 158.5 L 392.37 158.5" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 387.12 158.5 L 394.12 155 L 392.37 158.5 L 394.12 162 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 645.37 256 L 672.7 256 L 672.7 301 L 693.63 301" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 698.88 301 L 691.88 304.5 L 693.63 301 L 691.88 297.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="526" y="246" width="119.37" height="20" rx="3" ry="3" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 117px; height: 1px; padding-top: 256px; margin-left: 527px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">async_file_appender</div></div></div></foreignObject></g><path d="M 585.68 446 L 585.7 498.5 L 493.5 498.5 L 493.5 544.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 493.5 549.88 L 490 542.88 L 493.5 544.63 L 497 542.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 585.68 446 L 585.7 498.5 L 678.5 498.5 L 678.5 544.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 678.5 549.88 L 675 542.88 L 678.5 544.63 L 682 542.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 586 346 L 586 376 L 585.7 376 L 585.68 399.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 585.68 404.88 L 582.19 397.88 L 585.68 399.63 L 589.19 397.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="530.5" y="326" width="111" height="20" rx="3" ry="3" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 109px; height: 1px; padding-top: 336px; margin-left: 532px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">buffer</div></div></div></foreignObject></g><rect x="700" y="246" width="420.63" height="110" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 413px; height: 1px; padding-top: 236px; margin-left: 705px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 120px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #FFB366; white-space: normal; word-wrap: normal; "><h1 style=""><span style="font-size: 23px;"><font style="font-size: 23px;"><span style="font-weight: normal;">3. </span>append buffer</font></span></h1><p style="">3.1. 判断当前字符串长度是否超过当前的buffer数组<br />3.2. 如果小于等于那就直接append到当前buffer里并结束<br />3.3. 如果大于那就将当前buffer加入buffers的vector中,并创建一个新的buffer,<br />       调用cond唤醒一个被阻塞的消费者消费buffer中的数据<br /><br /><br /></p></div></div></div></foreignObject></g><rect x="16" y="26" width="370" height="265" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 362px; height: 1px; padding-top: 16px; margin-left: 21px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 275px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #FFB366; white-space: normal; word-wrap: normal; "><h1>ThreadFunc函数</h1><p>1. 初始化buffer等多线程组件<br />     1.1  创建一个当前buffer的指针<br />     1.2  创建一个持久化的buffer vector<br />     1.3  创建一个 logfile 对象<br />2. while runnging 循环<br />     2.1 每秒中被唤醒一次检查当前buffer是否为空,为空就继续休眠<br />     2.2 不为空的话 移动当前buffer 加入buffers_ vector中<br />     2.3 将buffers_ 交换给 创建的持久化buffer vector用于消费<br />     2.4 重置当前的buffer<br />     2.5 如果持久化buffers太长就截断他<br />     2.6 遍历持久化的buffers vector 以buffer为单位 写入logfile中<br />     2.7 重置当前的 buffer 与持久化数组<br />     2.8 对日志文件flush<br />     2.9 如果线程被关闭,等待所有buffer写入后彻底停止循环<br /> 3. 再次flush 整个logfile 并结束函数<br /><br /><br /></p><p><br /><br /></p></div></div></div></foreignObject></g><path d="M 433.5 581 L 191 581 L 191 669.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 191 674.88 L 187.5 667.88 L 191 669.63 L 194.5 667.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="433.5" y="551" width="120" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 581px; margin-left: 435px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">MMAP File Writer</div></div></div></foreignObject></g><path d="M 738.5 581 L 933 581 L 933 669.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 933 674.88 L 929.5 667.88 L 933 669.63 L 936.5 667.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="618.5" y="551" width="120" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 581px; margin-left: 620px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">APPEND File Writer</div></div></div></foreignObject></g><rect x="16" y="676" width="350" height="120" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 342px; height: 1px; padding-top: 666px; margin-left: 21px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 130px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #FFB366; white-space: normal; word-wrap: normal; "><h1>6.Append<br /></h1><div>1. 如果当前写入的数据size大于剩余空间就报错<br />2. 否则memcp到下一个可写位置处开始拷贝</div><div><br /></div><div>(创建文件时需要进行系统调用将内存的一片空间与mmap相关联)</div><div><br /></div></div></div></div></foreignObject></g><rect x="740" y="676" width="386" height="120" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 378px; height: 1px; padding-top: 666px; margin-left: 745px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 130px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #FFB366; white-space: normal; word-wrap: normal; "><h1>6.Append<br /></h1><div>1. 调用无锁的文件写入系统调用,将数据写入关联的fd对应的文件IO处</div><div>2. 如果被中断,有数据没有写完,则循环进行<br />      2.1 如果返回为0 判断是否报错 是就打印错误<br />      2.2  如果返回为0没有报错 证明已经全部写入<br />3.  累加已经写入的字节数</div></div></div></div></foreignObject></g><path d="M 637.18 426 L 668.6 426 L 668.6 461 L 693.63 461" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 698.88 461 L 691.88 464.5 L 693.63 461 L 691.88 457.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 534.18 426 L 490.1 426 L 490.1 451 L 452.37 451" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 447.12 451 L 454.12 447.5 L 452.37 451 L 454.12 454.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="534.18" y="406" width="103" height="40" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 101px; height: 1px; padding-top: 426px; margin-left: 535px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">LogFile</div></div></div></foreignObject></g><rect x="700" y="376" width="416" height="170" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 408px; height: 1px; padding-top: 366px; margin-left: 705px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 180px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #FFB366; white-space: normal; word-wrap: normal; "><h1>4.logfile.append</h1><div>1. 写入底层fd对应的磁盘</div><div>2. 如果已经写入的字节数大于了配置的文件大小,则滚动日志进行切割</div><div>3. 对文件写入进行计数</div><div>     3.1 判断距离上次滚动写入的次数是否大于等于配置的上限<br />            3.1.1 计数值清零</div><div>            3.1.2  判断日志是否跨天 如果是 那就 滚动日志进行切割</div><div>            3.1.3  如果不是判断距离上一次滚动是否超过配置的时间上限                        是就刷新日志</div><div><br /></div></div></div></div></foreignObject></g><rect x="76" y="386" width="370" height="130" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 362px; height: 1px; padding-top: 376px; margin-left: 81px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 140px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #FFB366; white-space: normal; word-wrap: normal; "><h1>5.rollFile</h1><p>1.  获取新的文件名<br />2.  如果当前时间大于上一次滚动的时间<br />3.  更新起始时间 并根据配置的appender 类型 创建新的 file writer</p></div></div></div></foreignObject></g><rect x="433.5" y="126" width="40" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 136px; margin-left: 454px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">初始化时创建一个线程进行循环</div></div></div></foreignObject></g></g></svg>